const chart=$query("#chart"),loaders=$queryAll(".loader"),lchart=$query(".chart-loader"),filter=$query("#filter"),data=$query("#data-tickets"),remove=$query("meta[name=rtl]"),rtl=+remove.content;function flip(e){return rtl?e.reverse():e}function zero(e){return e.some(e=>0!==e)}function exec({scene:e}){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgtick(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},headPdfStyle:function(){return this.headStyle}},{name:"subject",text:$trans("Subject"),bodyStyle:function(e){return bgtick(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize(e.subject),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"category",text:$trans("Category"),bodyStyle:function(e){return bgtick(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize($trans(e.category)),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgtick(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"action",text:$trans("Actions"),headStyle:{width:20,textAlign:"center"},bodyStyle:function(e){return{...bgtick(e),width:20,textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:t=>`<action-tools target="${t.id}" scene="${e}"></action-tools>`,headPdfStyle:function(){return this.headStyle},bodyPdfRender:()=>empty(),bodyCsvRender:()=>empty()}]}remove.remove(),loaders.forEach(e=>{setTimeout(()=>{e.remove()},Math.floor(500*Math.random())+500)}),(async()=>{let e=await getData($routes.chart);zero(e.creances)||zero(e.payments)||zero(e.charges)?(e.keys=e.keys.map(e=>$trans(e)),new Chart(chart,{data:{labels:flip(e.keys),datasets:[...zero(e.creances)?[{order:2,type:"bar",borderWidth:2,label:$trans("Creance"),data:flip(e.creances),backgroundColor:"rgb(234 179 8)",borderColor:"rgb(234 179 8)"}]:[],...zero(e.payments)?[{order:2,type:"bar",borderWidth:2,label:$trans("Payments"),data:flip(e.payments),backgroundColor:"rgb(34 197 94)",borderColor:"rgb(34 197 94)"}]:[],...zero(e.charges)?[{order:1,type:"line",borderWidth:2,label:$trans("Charges"),data:flip(e.charges),backgroundColor:"rgb(239 68 68)",borderColor:"rgb(239 68 68)"}]:[],]},options:{responsive:!0,scales:{y:{position:rtl?"right":"left"}},animation:{onComplete(){lchart.remove()}}}})):chart.parentElement.innerHTML=notFound()})(),TableVisualizer($query("#data-popular"),()=>[{name:"owner",text:$trans("Company")},{name:"vehicle",text:$trans("Vehicle")},{name:"paid",text:$trans("Payment"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>$money(+e.paid,2)+" "+$core.currency,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"rest",text:$trans("Creance"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>$money(+e.rest,2)+" "+$core.currency,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"mileage",text:$trans("Mileage"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>e.mileage+" "+$trans("Km"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"period",text:$trans("Rental period"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>e.period+" "+$trans("Days"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},]),filter.addEventListener("change",e=>{TableVisualizer(data,exec,{search:$routes[e.detail.data?"filter":"entire"],scene:$routes.scene})}),TableVisualizer(data,exec,{search:$routes.filter,scene:$routes.scene});