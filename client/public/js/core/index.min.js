const donut=$query("#donut"),chart=$query("#chart"),loaders=$queryAll(".loader"),ldonut=$query(".donut-loader"),lchart=$query(".chart-loader"),filter=$query("#filter"),data=$query("#data-tickets"),remove=[$query("meta[name=count]"),$query("meta[name=rtl]")],counts=JSON.parse(remove[0].content),rtl=+remove[1].content;function flip(e){return rtl?e.reverse():e}function zero(e){return e.some(e=>0!==e)}function exec(){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgtick(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},headPdfStyle:function(){return this.headStyle}},{name:"subject",text:$trans("Subject"),bodyStyle:function(e){return bgtick(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize(e.subject),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"category",text:$trans("Category"),bodyStyle:function(e){return bgtick(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize($trans(e.category)),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgtick(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}}]}remove.forEach(e=>e.remove()),loaders.forEach(e=>{setTimeout(()=>{e.remove()},Math.floor(500*Math.random())+500)}),new Chart(donut,{type:"doughnut",data:{labels:flip([$trans("Payments"),$trans("Charges")]),datasets:[{data:flip(counts),borderWidth:1,backgroundColor:flip(["rgb(34 197 94)","rgb(239 68 68)"]),borderColor:flip(["rgb(34 197 94)","rgb(239 68 68)"])},]},options:{responsive:!0,cutout:"70%",plugins:{legend:{display:!1}},animation:{onComplete(){ldonut.remove()}}}}),(async()=>{let e=await getData($routes.chart);zero(e.creances)||zero(e.payments)||zero(e.charges)?(e.keys=e.keys.map(e=>$trans(e)),new Chart(chart,{data:{labels:flip(e.keys),datasets:[...zero(e.creances)?[{order:2,type:"bar",borderWidth:2,label:$trans("Creance"),data:flip(e.creances),backgroundColor:"rgb(234 179 8)",borderColor:"rgb(234 179 8)"}]:[],...zero(e.payments)?[{order:2,type:"bar",borderWidth:2,label:$trans("Payments"),data:flip(e.payments),backgroundColor:"rgb(34 197 94)",borderColor:"rgb(34 197 94)"}]:[],...zero(e.charges)?[{order:1,type:"line",borderWidth:2,label:$trans("Charges"),data:flip(e.charges),backgroundColor:"rgb(239 68 68)",borderColor:"rgb(239 68 68)"}]:[],]},options:{responsive:!0,scales:{y:{position:rtl?"right":"left"}},animation:{onComplete(){lchart.remove()}}}})):chart.parentElement.innerHTML=notFound()})(),TableVisualizer($query("#data-popular"),()=>[{name:"vehicle",text:$trans("Vehicle")},{name:"paid",text:$trans("Payment"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>$money(+e.paid,2)+" "+$core.currency,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"rest",text:$trans("Creance"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>$money(+e.rest,2)+" "+$core.currency,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"mileage",text:$trans("Mileage"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>e.mileage+" "+$trans("Km"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"period",text:$trans("Rental period"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>e.period+" "+$trans("Days"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},]),filter.addEventListener("change",e=>{TableVisualizer(data,exec,{search:$routes[e.detail.data?"filter":"entire"]},!0)}),TableVisualizer(data,exec,{search:$routes.filter},!0);