const donut=$query("#donut"),chart=$query("#chart"),loaders=$queryAll(".loader"),ldonut=$query(".donut-loader"),lchart=$query(".chart-loader"),remove=[$query("meta[name=count]"),$query("meta[name=rtl]")],loan=$query("meta[name=loan]"),counts=JSON.parse(remove[0].content),rtl=+remove[1].content;function flip(e){return rtl?e.reverse():e}function zero(e){return e.some(e=>0!==e)}if(remove.forEach(e=>e.remove()),loaders.forEach(e=>{setTimeout(()=>{e.remove()},Math.floor(500*Math.random())+500)}),zero(counts)?new Chart(donut,{type:"doughnut",data:{labels:flip([$trans("Payments"),$trans("Charges")]),datasets:[{data:flip(counts),borderWidth:1,backgroundColor:flip(["rgb(34 197 94)","rgb(239 68 68)"]),borderColor:flip(["rgb(34 197 94)","rgb(239 68 68)"])},]},options:{responsive:!0,cutout:"70%",plugins:{legend:{display:!1}},animation:{onComplete(){ldonut.remove()}}}}):(donut.parentElement.innerHTML=notFound(),setTimeout(()=>{ldonut.remove()},Math.floor(500*Math.random())+500)),loan){let e=JSON.parse(loan.content),t=$query("#donut-loan"),n=$query(".donut-loan-loader");loan.remove(),new Chart(t,{type:"doughnut",data:{labels:flip([$trans("Paid amount"),$trans("Due amount")]),datasets:[{data:flip(e),borderWidth:1,backgroundColor:flip(["rgb(34 197 94)","rgb(234 179 8)"]),borderColor:flip(["rgb(34 197 94)","rgb(234 179 8)"])},]},options:{responsive:!0,cutout:"70%",plugins:{legend:{display:!1}},animation:{onComplete(){n.remove()}}}})}(async()=>{let e=await getData($routes.chart);zero(e.creances)||zero(e.payments)||zero(e.charges)?(e.keys=e.keys.map(e=>$trans(e)),new Chart(chart,{data:{labels:flip(e.keys),datasets:[...zero(e.creances)?[{order:2,type:"bar",borderWidth:2,label:$trans("Creance"),data:flip(e.creances),backgroundColor:"rgb(234 179 8)",borderColor:"rgb(234 179 8)"}]:[],...zero(e.payments)?[{order:2,type:"bar",borderWidth:2,label:$trans("Payments"),data:flip(e.payments),backgroundColor:"rgb(34 197 94)",borderColor:"rgb(34 197 94)"}]:[],...zero(e.charges)?[{order:1,type:"line",borderWidth:2,label:$trans("Charges"),data:flip(e.charges),backgroundColor:"rgb(239 68 68)",borderColor:"rgb(239 68 68)"}]:[],]},options:{responsive:!0,scales:{y:{position:rtl?"right":"left"}},animation:{onComplete(){lchart.remove()}}}})):(chart.parentElement.innerHTML=notFound(),lchart.remove())})();const filterReservations=$query("#filter-reservations"),filterRecoveries=$query("#filter-recoveries"),filterPayments=$query("#filter-payments"),dataReservations=$query("#data-reservations"),dataRecoveries=$query("#data-recoveries"),dataPayments=$query("#data-payments");function execReservations(e){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},headPdfStyle:function(){return this.headStyle}},{name:"renter",text:$trans("Renter"),bodyStyle:function(e){return bgdate(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.agency?`<div>${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}</div>`:e.client?`<div>${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}</div>`+(e.sclient?`<div>${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}</div>`:""):void 0,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.agency?`${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}`:e.client?`${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}`+(e.sclient?`, ${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}`:""):void 0},{name:"pickup",text:$trans("Pickup"),bodyStyle:function(e){return bgdate(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.pickup_location?`<div>${$capitalize($trans("Date"))}: ${$moment(e.pickup_date,$core.format+" hh:MM A")}</div><div>${$capitalize($trans("Location"))}: ${$capitalize(e.pickup_location)}</div>`:$moment(e.pickup_date,$core.format+" hh:MM A"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.pickup_location?`${$capitalize($trans("Date"))}: ${$moment(e.pickup_date,$core.format+" hh:MM A")}, ${$capitalize($trans("Location"))}: ${$capitalize(e.pickup_location)}`:$moment(e.pickup_date,$core.format+" hh:MM A")},{name:"dropoff",text:$trans("Dropoff"),bodyStyle:function(e){return bgdate(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.dropoff_location?`<div>${$capitalize($trans("Date"))}: ${$moment(e.dropoff_date,$core.format+" hh:MM A")}</div><div>${$capitalize($trans("Location"))}: ${$capitalize(e.dropoff_location)}</div>`:$moment(e.dropoff_date,$core.format+" hh:MM A"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.dropoff_location?`${$capitalize($trans("Date"))}: ${$moment(e.dropoff_date,$core.format+" hh:MM A")}, ${$capitalize($trans("Location"))}: ${$capitalize(e.dropoff_location)}`:$moment(e.dropoff_date,$core.format+" hh:MM A")},{name:"rental_period_days",text:$trans("Rental period"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.rental_period_days+" "+$trans("Days"),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"mileage",text:$trans("Mileage"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.mileage+" "+$trans("Km"),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"fuel_level",text:$trans("Fuel level"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$money(+e.fuel_level,2)+" %",headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},actionColumn({...e,css:{body:bgdate}})]}function execRecoveries(e){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.reference,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"renter",text:$trans("Renter"),bodyStyle:function(e){return bgdate(e)},bodyRender:e=>e.agency?`<div>${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}</div>`:e.client?`<div>${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}</div>`+(e.sclient?`<div>${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}</div>`:""):void 0,bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.agency?`${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}`:e.client?`${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}`+(e.sclient?`, ${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}`:""):void 0},{name:"mileage",text:$trans("Mileage"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>e.mileage+" "+$trans("Km"),headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"fuel_level",text:$trans("Fuel level"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$money(+e.fuel_level,2)+" %",headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"penalties",text:$trans("Penalties"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$money(+JSON.parse(e.penalties).reduce((e,t)=>e+t.cost,0),2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},actionColumn({...e,css:{body:bgdate}})]}function execPayments(e){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.reference,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"renter",text:$trans("Renter"),bodyStyle:function(e){return bgdate(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.agency?`<div>${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}</div>`:e.client?`<div>${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}</div>`+(e.sclient?`<div>${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}</div>`:""):void 0,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.agency?`${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}`:e.client?`${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}`+(e.sclient?`, ${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}`:""):void 0},{name:"daily_rate",text:$trans("Daily rate"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$money(+e.daily_rate,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"total",text:$trans("Total"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$money(+e.total,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"paid",text:$trans("Payment"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$money(+e.paid,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"rest",text:$trans("Creance"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$money(+e.rest,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},actionColumn({...e,css:{body:bgdate}})]}filterReservations.addEventListener("change",e=>{filterReservations.parentElement.label=e.detail.data?$trans("Show all reservations"):$trans("Show pending reservations"),TableVisualizer(dataReservations,execReservations,{search:$routes[e.detail.data?"filterReservations":"entireReservations"],patch:$routes.patchReservation,print:$routes.printReservation})}),filterRecoveries.addEventListener("change",e=>{filterRecoveries.parentElement.label=e.detail.data?$trans("Show all recoveries"):$trans("Show pending recoveries"),TableVisualizer(dataRecoveries,execRecoveries,{search:$routes[e.detail.data?"filterRecoveries":"entireRecoveries"],patch:$routes.patchRecovery})}),filterPayments.addEventListener("change",e=>{filterPayments.parentElement.label=e.detail.data?$trans("Show all payments"):$trans("Show pending payments"),TableVisualizer(dataPayments,execPayments,{search:$routes[e.detail.data?"filterPayments":"entirePayments"],patch:$routes.patchPayment})}),TableVisualizer(dataReservations,execReservations,{search:$routes.filterReservations,patch:$routes.patchReservation,print:$routes.printReservation}),TableVisualizer(dataRecoveries,execRecoveries,{search:$routes.filterRecoveries,patch:$routes.patchRecovery}),TableVisualizer(dataPayments,execPayments,{search:$routes.filterPayments,patch:$routes.patchPayment}),TableVisualizer($query("#data-charges"),e=>[{name:"name",text:$trans("Name"),bodyRender:e=>$capitalize(e.name),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"cost",text:$trans("Cost"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+e.cost,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"details",text:$trans("Details"),headStyle:{maxWidth:300},bodyStyle:function(){return this.headStyle},bodyRender:e=>e.details?e.details:empty(),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},actionColumn(e)],{search:$routes.entireCharges,patch:$routes.patchCharge,clear:$routes.clearCharge});