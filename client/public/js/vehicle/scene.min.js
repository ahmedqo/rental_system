const donut=$query("#donut"),chart=$query("#chart"),loaders=$queryAll(".loader"),ldonut=$query(".donut-loader"),lchart=$query(".chart-loader"),remove=[$query("meta[name=count]"),$query("meta[name=rtl]")],counts=JSON.parse(remove[0].content),rtl=+remove[1].content;function flip(e){return rtl?e.reverse():e}function zero(e){return e.some(e=>0!==e)}remove.forEach(e=>e.remove()),loaders.forEach(e=>{setTimeout(()=>{e.remove()},Math.floor(500*Math.random())+500)}),new Chart(donut,{type:"doughnut",data:{labels:flip([$trans("Payments"),$trans("Charges")]),datasets:[{data:flip(counts),borderWidth:1,backgroundColor:flip(["rgb(34 197 94)","rgb(239 68 68)"]),borderColor:flip(["rgb(34 197 94)","rgb(239 68 68)"])},]},options:{responsive:!0,cutout:"70%",plugins:{legend:{display:!1}},animation:{onComplete(){ldonut.remove()}}}}),(async()=>{let e=await getData($routes.chart);zero(e.creances)||zero(e.payments)||zero(e.charges)?(e.keys=e.keys.map(e=>$trans(e)),new Chart(chart,{data:{labels:flip(e.keys),datasets:[...zero(e.creances)?[{order:2,type:"bar",borderWidth:2,label:$trans("Creance"),data:flip(e.creances),backgroundColor:"rgb(234 179 8)",borderColor:"rgb(234 179 8)"}]:[],...zero(e.payments)?[{order:2,type:"bar",borderWidth:2,label:$trans("Payments"),data:flip(e.payments),backgroundColor:"rgb(34 197 94)",borderColor:"rgb(34 197 94)"}]:[],...zero(e.charges)?[{order:1,type:"line",borderWidth:2,label:$trans("Charges"),data:flip(e.charges),backgroundColor:"rgb(239 68 68)",borderColor:"rgb(239 68 68)"}]:[],]},options:{responsive:!0,scales:{y:{position:rtl?"right":"left"}},animation:{onComplete(){lchart.remove()}}}})):chart.parentElement.innerHTML=`<span class="block text-x-black font-x-thin text-lg text-center">${$trans("No data found")}</span>`})();const filterReservations=$query("#filter-reservations"),filterRecoveries=$query("#filter-recoveries"),filterPayments=$query("#filter-payments"),dataReservations=$query("#data-reservations"),dataRecoveries=$query("#data-recoveries"),dataPayments=$query("#data-payments");function execReservations({patch:e,print:t}){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},headPdfStyle:function(){return this.headStyle}},{name:"renter",text:$trans("Renter"),bodyStyle:function(e){return bgdate(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.agency?`<div>${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}</div>`:e.client?`<div>${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}</div>`+(e.sclient?`<div>${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}</div>`:""):void 0,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.agency?`${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}`:e.client?`${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}`+(e.sclient?`, ${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}`:""):void 0},{name:"pickup",text:$trans("Pickup"),bodyStyle:function(e){return bgdate(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.pickup_location?`<div>${$capitalize($trans("Date"))}: ${$moment(e.pickup_date,$core.format+" hh:MM A")}</div><div>${$capitalize($trans("Location"))}: ${$capitalize(e.pickup_location)}</div>`:$moment(e.pickup_date,$core.format+" hh:MM A"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.pickup_location?`${$capitalize($trans("Date"))}: ${$moment(e.pickup_date,$core.format+" hh:MM A")}, ${$capitalize($trans("Location"))}: ${$capitalize(e.pickup_location)}`:$moment(e.pickup_date,$core.format+" hh:MM A")},{name:"dropoff",text:$trans("Dropoff"),bodyStyle:function(e){return bgdate(e)},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.dropoff_location?`<div>${$capitalize($trans("Date"))}: ${$moment(e.dropoff_date,$core.format+" hh:MM A")}</div><div>${$capitalize($trans("Location"))}: ${$capitalize(e.dropoff_location)}</div>`:$moment(e.dropoff_date,$core.format+" hh:MM A"),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.dropoff_location?`${$capitalize($trans("Date"))}: ${$moment(e.dropoff_date,$core.format+" hh:MM A")}, ${$capitalize($trans("Location"))}: ${$capitalize(e.dropoff_location)}`:$moment(e.dropoff_date,$core.format+" hh:MM A")},{name:"rental_period_days",text:$trans("Rental period"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.rental_period_days+" "+$trans("Days"),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"mileage",text:$trans("Mileage"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>e.mileage+" "+$trans("Km"),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"fuel_level",text:$trans("Fuel level"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$money(+e.fuel_level,2)+" %",headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"action",text:$trans("Actions"),headStyle:{width:20,textAlign:"center"},bodyStyle:function(e){return{...bgdate(e),width:20,textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:n=>`<action-tools target="${n.id}" patch="${e}" print="${t}"></action-tools>`,headPdfStyle:function(){return this.headStyle},bodyPdfRender:()=>empty(),bodyCsvRender:()=>empty()}]}function execRecoveries({patch:e}){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>e.reference,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"renter",text:$trans("Renter"),bodyRender:e=>e.agency?`<div>${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}</div>`:e.client?`<div>${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}</div>`+(e.sclient?`<div>${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}</div>`:""):void 0,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.agency?`${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}`:e.client?`${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}`+(e.sclient?`, ${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}`:""):void 0},{name:"mileage",text:$trans("Mileage"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>e.mileage+" "+$trans("Km"),headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"fuel_level",text:$trans("Fuel level"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+e.fuel_level,2)+" %",headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"penalties",text:$trans("Penalties"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+JSON.parse(e.penalties).reduce((e,t)=>e+t.cost,0),2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"action",text:$trans("Actions"),headStyle:{width:20,textAlign:"center"},bodyStyle:function(e){return new Date(e.dropoff_date).getTime()<(new Date).getTime()&&"pending"===e.status?{background:"#ffc4c0",width:20,textAlign:"center"}:{width:20,textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:t=>`<action-tools target="${t.id}" patch="${e}"></action-tools>`,headPdfStyle:function(){return this.headStyle},bodyPdfRender:()=>empty(),bodyCsvRender:()=>empty()}]}function execPayments({patch:e}){return[{name:"reference",text:$trans("Reference"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyRender:e=>e.reference,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"renter",text:$trans("Renter"),bodyRender:e=>e.agency?`<div>${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}</div>`:e.client?`<div>${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}</div>`+(e.sclient?`<div>${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}</div>`:""):void 0,bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:e=>e.agency?`${$capitalize($trans("Agency"))}: ${$capitalize(e.agency.name)}`:e.client?`${$capitalize($trans("Client"))}: ${e.client.last_name.toUpperCase()+" "+$capitalize(e.client.first_name)}`+(e.sclient?`, ${$capitalize($trans("Secondary client"))}: ${e.sclient.last_name.toUpperCase()+" "+$capitalize(e.sclient.first_name)}`:""):void 0},{name:"daily_rate",text:$trans("Daily rate"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+e.daily_rate,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"total",text:$trans("Total"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+e.total,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"paid",text:$trans("Payment"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+e.paid,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"rest",text:$trans("Creance"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+e.rest,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"status",text:$trans("Status"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$capitalize($trans(e.status)),headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"action",text:$trans("Actions"),headStyle:{width:20,textAlign:"center"},bodyStyle:function(e){return new Date(e.dropoff_date).getTime()<(new Date).getTime()&&"pending"===e.status?{background:"#ffc4c0",width:20,textAlign:"center"}:{width:20,textAlign:"center"}},bodyPdfStyle:function(e){return this.bodyStyle(e)},bodyRender:t=>`<action-tools target="${t.id}" patch="${e}"></action-tools>`,headPdfStyle:function(){return this.headStyle},bodyPdfRender:()=>empty(),bodyCsvRender:()=>empty()}]}filterReservations.addEventListener("change",e=>{TableVisualizer(dataReservations,execReservations,{search:$routes[e.detail.data?"filterReservations":"entireReservations"],patch:$routes.patchReservation,print:$routes.printReservation})}),filterRecoveries.addEventListener("change",e=>{TableVisualizer(dataRecoveries,execRecoveries,{search:$routes[e.detail.data?"filterRecoveries":"entireRecoveries"],patch:$routes.patchRecovery})}),filterPayments.addEventListener("change",e=>{TableVisualizer(dataPayments,execPayments,{search:$routes[e.detail.data?"filterPayments":"entirePayments"],patch:$routes.patchPayment})}),TableVisualizer(dataReservations,execReservations,{search:$routes.filterReservations,patch:$routes.patchReservation,print:$routes.printReservation}),TableVisualizer(dataRecoveries,execRecoveries,{search:$routes.filterRecoveries,patch:$routes.patchRecovery}),TableVisualizer(dataPayments,execPayments,{search:$routes.filterPayments,patch:$routes.patchPayment}),TableVisualizer($query("#data-charges"),({csrf:e,patch:t,clear:n})=>[{name:"name",text:$trans("Name"),bodyRender:e=>$capitalize(e.name),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"cost",text:$trans("Cost"),headStyle:{textAlign:"center"},bodyStyle:{textAlign:"center"},bodyRender:e=>$money(+e.cost,2)+" "+$core.currency,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"details",text:$trans("Details"),headStyle:{maxWidth:300},bodyStyle:function(){return this.headStyle},bodyRender:e=>e.details?e.details:empty(),bodyPdfRender:function(e){return this.bodyRender(e)},bodyCsvRender:function(e){return this.bodyRender(e)}},{name:"action",text:$trans("Actions"),headStyle:{width:20,textAlign:"center"},bodyStyle:{width:20,textAlign:"center"},bodyRender:r=>`<action-tools target="${r.id}"csrf="${e}"patch="${t}"clear="${n}"></action-tools>`,headPdfStyle:function(){return this.headStyle},bodyPdfStyle:function(){return this.bodyStyle},bodyPdfRender:()=>empty(),bodyCsvRender:()=>empty()}],{search:$routes.entireCharges,patch:$routes.patchCharge,clear:$routes.clearCharge});